<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="맨큐의 경제학 - 보고서/과제 관리. 보고서 작성, 과제 생성, 과제 채점 기능을 제공합니다.">
  <title>보고서 · 과제 관리 | 맨큐의 경제학</title>
  <link rel="stylesheet" href="css/style.css">
  <script>
    (function () {
      const t = localStorage.getItem('mankiw_theme') ||
        (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
      document.documentElement.setAttribute('data-theme', t);
    })();
  </script>
  <style>
    /* ── Tab Navigation ── */
    .tab-nav {
      display: flex;
      gap: 4px;
      margin-bottom: 2rem;
      background: var(--bg-tertiary);
      padding: 4px;
      border-radius: var(--radius-md);
    }

    .tab-btn {
      flex: 1;
      padding: 12px 16px;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      border-radius: var(--radius-sm);
      transition: all 0.25s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .tab-btn:hover {
      color: var(--text-primary);
      background: var(--bg-secondary);
    }

    .tab-btn.active {
      background: var(--primary-500);
      color: #fff;
      box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);
    }

    .tab-btn .tab-icon {
      font-size: 1.1rem;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(8px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* ── Assignment Card ── */
    .assignment-preview {
      background: var(--bg-secondary);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-md);
      padding: 2rem;
    }

    .assignment-preview h2 {
      color: var(--primary-400);
      margin-bottom: 0.5rem;
    }

    .rubric-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
      font-size: 0.85rem;
    }

    .rubric-table th,
    .rubric-table td {
      border: 1px solid var(--border-light);
      padding: 10px 12px;
      text-align: left;
    }

    .rubric-table th {
      background: var(--bg-tertiary);
      color: var(--text-primary);
      font-weight: 600;
    }

    .rubric-table td {
      color: var(--text-secondary);
    }

    /* ── Grading UI ── */
    .upload-zone {
      border: 2px dashed var(--border-light);
      border-radius: var(--radius-md);
      padding: 3rem 2rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      background: var(--bg-secondary);
    }

    .upload-zone:hover,
    .upload-zone.dragover {
      border-color: var(--primary-500);
      background: rgba(99, 102, 241, 0.05);
    }

    .upload-zone .upload-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }

    .upload-zone .upload-text {
      color: var(--text-secondary);
      font-size: 0.95rem;
    }

    .upload-zone .upload-hint {
      color: var(--text-muted);
      font-size: 0.8rem;
      margin-top: 0.5rem;
    }

    .file-info {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      background: var(--bg-tertiary);
      border-radius: var(--radius-sm);
      margin-top: 1rem;
    }

    .file-info .file-name {
      flex: 1;
      font-size: 0.9rem;
      color: var(--text-primary);
    }

    .file-info .file-size {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .grade-result {
      margin-top: 1.5rem;
    }

    .grade-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-md);
      padding: 1.5rem;
      margin-bottom: 1rem;
    }

    .grade-card h3 {
      color: var(--primary-400);
      font-size: 1rem;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .score-bar {
      height: 8px;
      background: var(--bg-tertiary);
      border-radius: 4px;
      overflow: hidden;
      margin: 8px 0;
    }

    .score-bar-fill {
      height: 100%;
      border-radius: 4px;
      transition: width 1s ease;
    }

    .score-label {
      display: flex;
      justify-content: space-between;
      font-size: 0.85rem;
      color: var(--text-secondary);
    }

    .score-high {
      background: linear-gradient(90deg, #10b981, #34d399);
    }

    .score-medium {
      background: linear-gradient(90deg, #f59e0b, #fbbf24);
    }

    .score-low {
      background: linear-gradient(90deg, #ef4444, #f87171);
    }

    .ai-risk-high {
      color: #ef4444;
      font-weight: 700;
    }

    .ai-risk-medium {
      color: #f59e0b;
      font-weight: 700;
    }

    .ai-risk-low {
      color: #10b981;
      font-weight: 700;
    }

    .feedback-item {
      padding: 10px 0;
      border-bottom: 1px solid var(--border-light);
      font-size: 0.9rem;
      color: var(--text-secondary);
    }

    .feedback-item:last-child {
      border-bottom: none;
    }

    .grade-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      font-size: 1.5rem;
      font-weight: 800;
    }
  </style>
</head>

<body>
  <div class="main-content">
    <div class="page-container">
      <div class="page-header">
        <h1>보고서 · 과제 관리</h1>
        <p>보고서 작성, 과제 생성, AI 채점을 한 곳에서 관리합니다</p>
      </div>

      <!-- Tab Navigation -->
      <div class="tab-nav">
        <button class="tab-btn active" onclick="switchTab('report')" id="tabBtnReport">
          <span class="tab-icon"><i class="fa-solid fa-file-lines"></i></span> 보고서 작성
        </button>
        <button class="tab-btn" onclick="switchTab('assignment')" id="tabBtnAssignment">
          <span class="tab-icon"><i class="fa-solid fa-clipboard-list"></i></span> 과제 생성
        </button>
        <button class="tab-btn" onclick="switchTab('grading')" id="tabBtnGrading">
          <span class="tab-icon"><i class="fa-solid fa-spell-check"></i></span> 과제 채점
        </button>
      </div>

      <!-- ═══════════════════════════════════════ -->
      <!--  TAB 1: 보고서 작성하기 (기존 유지)       -->
      <!-- ═══════════════════════════════════════ -->
      <div class="tab-content active" id="tabReport">
        <div style="display: grid; grid-template-columns: 380px 1fr; gap: 2rem; align-items: start;">
          <div class="sidebar" style="position: sticky; top: calc(var(--nav-height) + 2rem);">
            <div class="sidebar-title">보고서 설정</div>
            <div class="form-group">
              <label class="form-label">관련 챕터</label>
              <select class="form-select" id="reportChapter" onchange="updateTopicSuggestions()">
                <option value="">챕터를 선택하세요</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">보고서 주제</label>
              <input type="text" class="form-input" id="reportTopic" placeholder="예: 최저임금 인상의 경제적 효과">
              <div class="form-hint">직접 입력하거나 아래 추천 주제를 선택하세요</div>
            </div>
            <div class="form-group">
              <label class="form-label">추천 주제</label>
              <div id="suggestedTopics" style="display: flex; flex-direction: column; gap: 6px;">
                <div style="font-size: 0.8rem; color: var(--text-muted);">챕터를 선택하면 추천 주제가 표시됩니다</div>
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">보고서 유형</label>
              <select class="form-select" id="reportType">
                <option value="analysis">분석 보고서</option>
                <option value="comparison">비교 분석 보고서</option>
                <option value="case">사례 연구 보고서</option>
                <option value="policy">정책 제언 보고서</option>
                <option value="literature">문헌 조사 보고서</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">분량</label>
              <select class="form-select" id="reportLength">
                <option value="short">짧은 (A4 2-3매)</option>
                <option value="medium" selected>보통 (A4 5-7매)</option>
                <option value="long">긴 (A4 10매 이상)</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">수준</label>
              <select class="form-select" id="reportLevel">
                <option value="undergrad" selected>학부 수준</option>
                <option value="advanced">심화 수준</option>
              </select>
            </div>
            <button class="btn btn-primary w-full" onclick="generateReport()">보고서 생성하기</button>
          </div>
          <div>
            <div id="reportEmpty" class="content-panel">
              <div class="empty-state">
                <div class="empty-state-icon">—</div>
                <div class="empty-state-title">보고서를 만들어보세요</div>
                <div class="empty-state-desc">왼쪽에서 챕터를 선택하고, 주제를 입력한 후 '보고서 생성하기' 버튼을 클릭하세요.</div>
              </div>
            </div>
            <div id="reportOutput" class="hidden"></div>
          </div>
        </div>
      </div>

      <!-- ═══════════════════════════════════════ -->
      <!--  TAB 2: 과제 생성하기 (NEW)              -->
      <!-- ═══════════════════════════════════════ -->
      <div class="tab-content" id="tabAssignment">
        <div style="display: grid; grid-template-columns: 380px 1fr; gap: 2rem; align-items: start;">
          <div class="sidebar" style="position: sticky; top: calc(var(--nav-height) + 2rem);">
            <div class="sidebar-title">과제 설정</div>
            <div class="form-group">
              <label class="form-label">관련 챕터 (복수 선택 가능)</label>
              <div id="assignChapterList"
                style="max-height: 200px; overflow-y: auto; border: 1px solid var(--border-light); border-radius: var(--radius-sm); padding: 8px;">
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">과제 유형</label>
              <select class="form-select" id="assignType">
                <option value="essay">에세이 (논술형)</option>
                <option value="case_study">사례 분석</option>
                <option value="comparison">비교 분석</option>
                <option value="debate">토론문 작성</option>
                <option value="data_analysis">데이터 분석</option>
                <option value="policy_proposal">정책 제안서</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">난이도</label>
              <select class="form-select" id="assignDifficulty">
                <option value="basic">기본</option>
                <option value="intermediate" selected>중급</option>
                <option value="advanced">심화</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">분량 요구사항</label>
              <select class="form-select" id="assignLength">
                <option value="short">A4 2-3매 (1,000~1,500자)</option>
                <option value="medium" selected>A4 5-7매 (2,500~3,500자)</option>
                <option value="long">A4 10매 이상 (5,000자+)</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">제출 기한</label>
              <input type="date" class="form-input" id="assignDueDate">
            </div>
            <div class="form-group">
              <label class="form-label" style="display: flex; align-items: center; gap: 8px;">
                <input type="checkbox" id="assignIncludeRubric" checked> 채점 기준표 포함
              </label>
            </div>
            <button class="btn btn-primary w-full" onclick="generateAssignment()">과제 생성하기</button>
          </div>
          <div>
            <div id="assignEmpty" class="content-panel">
              <div class="empty-state">
                <div class="empty-state-icon"><i class="fa-solid fa-clipboard-list"
                    style="font-size: 2rem; opacity: 0.3;"></i></div>
                <div class="empty-state-title">과제를 생성해보세요</div>
                <div class="empty-state-desc">챕터와 과제 유형을 선택한 후 '과제 생성하기' 버튼을 클릭하면, 채점 기준표가 포함된 과제지가 자동으로 생성됩니다.</div>
              </div>
            </div>
            <div id="assignOutput" class="hidden"></div>
          </div>
        </div>
      </div>

      <!-- ═══════════════════════════════════════ -->
      <!--  TAB 3: 과제 채점하기 (NEW)              -->
      <!-- ═══════════════════════════════════════ -->
      <div class="tab-content" id="tabGrading">
        <div style="display: grid; grid-template-columns: 380px 1fr; gap: 2rem; align-items: start;">
          <div class="sidebar" style="position: sticky; top: calc(var(--nav-height) + 2rem);">
            <div class="sidebar-title">채점 설정</div>
            <div class="form-group">
              <label class="form-label">관련 챕터</label>
              <select class="form-select" id="gradeChapter">
                <option value="">챕터를 선택하세요</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">과제 주제 (선택)</label>
              <input type="text" class="form-input" id="gradeAssignTopic" placeholder="예: 최저임금의 경제적 효과">
              <div class="form-hint">과제 주제를 입력하면 내용 충실도를 더 정확히 평가합니다</div>
            </div>
            <div class="form-group">
              <label class="form-label">평가 항목</label>
              <label
                style="display: flex; align-items: center; gap: 8px; font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 6px; cursor: pointer;">
                <input type="checkbox" id="gradeAiDetect" checked> AI 작성 여부 탐지
              </label>
              <label
                style="display: flex; align-items: center; gap: 8px; font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 6px; cursor: pointer;">
                <input type="checkbox" id="gradeContent" checked> 내용 충실도 평가
              </label>
              <label
                style="display: flex; align-items: center; gap: 8px; font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 6px; cursor: pointer;">
                <input type="checkbox" id="gradeLogic" checked> 논리 구조 평가
              </label>
              <label
                style="display: flex; align-items: center; gap: 8px; font-size: 0.85rem; color: var(--text-secondary); cursor: pointer;">
                <input type="checkbox" id="gradeRef" checked> 참고문헌 적절성
              </label>
            </div>
            <div class="form-group">
              <label class="form-label">PDF 파일 업로드</label>
              <div class="upload-zone" id="uploadZone" onclick="document.getElementById('pdfInput').click()">
                <div class="upload-icon"><i class="fa-solid fa-cloud-arrow-up"></i></div>
                <div class="upload-text">클릭하여 PDF 파일을 선택하세요</div>
                <div class="upload-hint">또는 여기에 파일을 드래그 앤 드롭</div>
              </div>
              <input type="file" id="pdfInput" accept=".pdf,.txt" style="display: none;"
                onchange="handleFileSelect(event)">
              <div id="fileInfo" class="hidden"></div>
            </div>
            <button class="btn btn-primary w-full" onclick="gradeAssignment()" id="gradeBtn" disabled>
              채점 시작하기
            </button>
          </div>
          <div>
            <div id="gradeEmpty" class="content-panel">
              <div class="empty-state">
                <div class="empty-state-icon"><i class="fa-solid fa-spell-check"
                    style="font-size: 2rem; opacity: 0.3;"></i></div>
                <div class="empty-state-title">과제를 채점해보세요</div>
                <div class="empty-state-desc">
                  학생이 제출한 PDF 파일을 업로드하면, AI가 다음 항목을 자동으로 평가합니다:<br><br>
                  <strong>1. AI 작성 여부 탐지</strong> — ChatGPT 등 AI 도구 사용 의심도 분석<br>
                  <strong>2. 내용 충실도</strong> — 교과서 내용 기반 정확도 평가<br>
                  <strong>3. 논리 구조</strong> — 서론-본론-결론 체계성 평가<br>
                  <strong>4. 참고문헌</strong> — 인용의 적절성 및 다양성 평가
                </div>
              </div>
            </div>
            <div id="gradeOutput" class="hidden"></div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script src="js/data.js"></script>
  <script src="js/key_manager.js"></script>
  <script src="js/rag_client.js"></script>
  <script src="js/common.js"></script>
  <script src="js/report_app.js"></script>
</body>

</html>